## Protocol properties and invariants

Below is a list of all documented properties and invariants of this project that must hold true.

- **Property** - Describes the property of the project / protocol that should ultimately be tested and formaly verified.
- **Type** - Properties are split into 5 main types: **Valid State**, **State Transition**, **Variable Transition**,
  **High-Level Property**, **Unit Test**
- **Risk** - One of **High**, **Medium** and **Low**, depending on the property's risk factor
- **Tested** - Whether this property has been (fuzz) tested

| **Property**                                                                                                                                                                                                                               | **Type**            | **Risk** | **Tested**    |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ------------------- | -------- | ------------- |
| **StakeVault Properties**                                                                                                                                                                                                                  |                     |          |               |
| Total supply of staked tokens equals sum of all balances                                                                                                                                                                                   | Valid State         | High     | Yes (Certora) |
| Deposited balance must be less than or equal to ERC20 balance                                                                                                                                                                              | Valid State         | High     | Yes (Certora) |
| Deposited balance + excess balance equals ERC20 balance                                                                                                                                                                                    | Valid State         | High     | Yes (Certora) |
| Deposited balance equals staked balance (in StakeManager)                                                                                                                                                                                  | Valid State         | High     | Yes (Certora) |
| If staked balance is zero, deposited balance must be zero                                                                                                                                                                                  | Valid State         | High     | Yes (Certora) |
| If ERC20 balance is zero, deposited balance must be zero                                                                                                                                                                                   | Valid State         | High     | Yes (Certora) |
| Owner cannot change after initialization                                                                                                                                                                                                   | State Transition    | High     | Yes (Certora) |
| Owner can only withdraw staked funds when not locked                                                                                                                                                                                       | State Transition    | High     | Yes (Certora) |
| Vault ERC20 balance must be >= staked balance in StakeManager                                                                                                                                                                              | Valid State         | High     | Yes (Certora) |
| **Emergency Mode Properties**                                                                                                                                                                                                              |                     |          |               |
| Only specific functions allowed during emergency mode (leave, view functions, access control, pausable, trusted codehash, initializer, UUPS upgrade)                                                                                       | State Transition    | High     | Yes (Certora) |
| Restricted functions must revert in emergency mode (updateGlobalState, setRewardsSupplier, registerVault, migrateToVault, updateAccount, updateVault, unstake, stake, lock, setReward, enableEmergencyMode, pause, unpause, redeemRewards) | State Transition    | High     | Yes (Certora) |
| **Karma Properties**                                                                                                                                                                                                                       |                     |          |               |
| ERC20 transfer functions disabled for non-whitelisted accounts                                                                                                                                                                             | State Transition    | High     | Yes (Certora) |
| Admin functions only callable by DEFAULT_ADMIN_ROLE (addRewardDistributor, removeRewardDistributor)                                                                                                                                        | State Transition    | High     | Yes (Certora) |
| Operator functions callable by admin and OPERATOR_ROLE only (setReward, mint)                                                                                                                                                              | State Transition    | High     | Yes (Certora) |
| **Leave Mode Properties**                                                                                                                                                                                                                  |                     |          |               |
| After leaving, only specific functions allowed (view, ownable, initialize, leave, withdraw, unstake, register, migrateFromVault, emergencyExit)                                                                                            | State Transition    | High     | Yes (Certora) |
| **StakeManager Properties**                                                                                                                                                                                                                |                     |          |               |
| Sum of all vault staked balances equals total staked                                                                                                                                                                                       | Valid State         | High     | Yes (Certora) |
| Vault MP accrued must be <= vault max MP                                                                                                                                                                                                   | Valid State         | High     | Yes (Certora) |
| Vault MP accrued must be >= vault staked balance                                                                                                                                                                                           | Valid State         | High     | Yes (Certora) |
| Staking with zero lockup mints multiplier points at 1:1 ratio                                                                                                                                                                              | Variable Transition | High     | Yes (Certora) |
| Greater lockup time results in greater multiplier points                                                                                                                                                                                   | Variable Transition | High     | Yes (Certora) |
| Multiplier points only decrease when unstaking or leaving                                                                                                                                                                                  | Variable Transition | High     | Yes (Certora) |
| When paused, only specific functions allowed (view, initialize, upgrade, access control, trusted codehash, enableEmergencyMode, unpause)                                                                                                   | State Transition    | High     | Yes (Certora) |
