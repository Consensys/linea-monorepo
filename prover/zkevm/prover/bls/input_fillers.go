package bls

import (
	"fmt"

	"github.com/consensys/linea-monorepo/prover/maths/field"
	"github.com/consensys/linea-monorepo/prover/protocol/dedicated/plonk"
)

const (
	millerLoopInputFillerKey       = "bls12381-miller-loop-input-filler"
	finalExpInputFillerKey         = "bls12381-final-exp-input-filler"
	pointEvalInputFillerKey        = "bls12381-point-eval-input-filler"
	pointEvalFailureInputFillerKey = "bls12381-point-eval-failure-input-filler"
)

func init() {
	plonk.RegisterInputFiller(membershipInputFillerKey(G1, CURVE), newMembershipInputFiller(G1, CURVE))
	plonk.RegisterInputFiller(membershipInputFillerKey(G2, CURVE), newMembershipInputFiller(G2, CURVE))
	plonk.RegisterInputFiller(membershipInputFillerKey(G1, GROUP), newMembershipInputFiller(G1, GROUP))
	plonk.RegisterInputFiller(membershipInputFillerKey(G2, GROUP), newMembershipInputFiller(G2, GROUP))
	plonk.RegisterInputFiller(millerLoopInputFillerKey, inputfillerMillerLoop)
	plonk.RegisterInputFiller(finalExpInputFillerKey, inputFillerFinalExp)
	plonk.RegisterInputFiller(mapToGroupInputFillerKey(G1), inputFillerMapToG1)
	plonk.RegisterInputFiller(mapToGroupInputFillerKey(G2), inputFillerMapToG2)
	plonk.RegisterInputFiller(pointEvalInputFillerKey, inputFillerPointEvaluation)
	plonk.RegisterInputFiller(pointEvalFailureInputFillerKey, inputFillerPointEvaluationFailure)
}

func membershipInputFillerKey(g Group, m membership) string {
	base := "bls12381-%s-membership-input-filler"
	switch m {
	case CURVE:
		return fmt.Sprintf(base, g.StringCurve())
	case GROUP:
		return fmt.Sprintf(base, g.String())
	default:
		panic(fmt.Sprintf("unknown membership type %v for group %v", m, g))
	}
}

func newMembershipInputFiller(g Group, _ membership) plonk.InputFiller {
	// we generate points not on curve --> also not in group
	return func(circuitInstance, inputIndex int) field.Element {
		nbL := nbLimbs(g)
		if (inputIndex+1)%(nbL/2) == 0 {
			return field.One()
		} else {
			return field.Zero()
		}
	}
}

func inputfillerMillerLoop(circuitInstance, inputIndex int) field.Element {
	// prev = 1
	// p = g1 gen
	// q = g2 gen
	// curr = e(p, q)
	// Each 128-bit limb is split into 8 16-bit sublimbs in little-endian order within the chunk.
	tbl := []string{
		// previous gt accumulator (identity = 1 in C0.B0.A0)
		// C0.B0.A0 = 1
		"0x0001", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		// C0.B0.A1 = 0
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		// C0.B1.A0 = 0
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		// C0.B1.A1 = 0
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		// C0.B2.A0 = 0
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		// C0.B2.A1 = 0
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		// C1.B0.A0 = 0
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		// C1.B0.A1 = 0
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		// C1.B1.A0 = 0
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		// C1.B1.A1 = 0
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		// C1.B2.A0 = 0
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		// C1.B2.A1 = 0
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		// g1 point X (G1 generator)
		// 0x17f1d3a73197d7942695638c4fa9ac0fc3688c4f9774b905a14e3a3f171bac586c55e83ff97a1aeffb3af00adb22c6bb
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0x9697", "0xca99", "0x212d", "0x1765", "0xf013", "0xf9d1", "0xe308", "0x09ec",
		"0x3ff9", "0x5b33", "0xa051", "0x3780", "0xa5f1", "0xf9be", "0x2b61", "0xb112",
		"0x5224", "0x024e", "0xc9c9", "0xb96d", "0x179b", "0xa2ca", "0xa0b2", "0x8174",
		// g1 point Y
		// 0x08b3f481e3aaa0f1a09e30ed741d8ae4fcf5e095d5d00af600db18cb2c04b3edd03cc744a2888ae40caa232946c5e7e1
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0x30d1", "0x90ae", "0xb005", "0x73c4", "0xf43a", "0x2b0c", "0xdef9", "0x0a4e",
		"0x3be6", "0xd43f", "0x1fd7", "0xbc70", "0x1572", "0x03e1", "0x4d10", "0xc611",
		"0x3577", "0x7c33", "0x288c", "0x6178", "0xec72", "0xb57e", "0x86f6", "0xc6c8",
		// g2 point X.A0
		// 0x024aa2b2f08f0a91260805272dc51051c6e47ad4fa403b02b4510b647ae3d1770bac0326a805bbefd48056c8c121bdb8
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0xa053", "0x7a82", "0xcab8", "0xb991", "0x00c9", "0x0b3b", "0x3bc0", "0x0995",
		"0xdbae", "0x4d00", "0xe1e1", "0xee1e", "0x25e0", "0xb8b8", "0x3353", "0x8853",
		"0xbdb8", "0xc121", "0x56c8", "0xd480", "0xbbef", "0xa805", "0x0326", "0x0bac",
		// g2 point X.A1
		// 0x13e02b6052719f607dacd3a088274f65596bd0d09920b61ab5da61bbdc7f5049334cf11213945d57e5ac7d055d042b7e
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0x4f65", "0x8827", "0xd3a0", "0x7dac", "0x9f60", "0x5271", "0x2b60", "0x13e0",
		"0x5049", "0xdc7f", "0x61bb", "0xb5da", "0xb61a", "0x9920", "0xd0d0", "0x596b",
		"0x2b7e", "0x5d04", "0x7d05", "0xe5ac", "0x5d57", "0x1394", "0xf112", "0x334c",
		// g2 point Y.A0
		// 0x0ce5d527727d6e118cc9cdc6da2e351aadfd9baa8cbdd3a76d429a695160d12c923ac9cc3baca289e193548608b82801
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0x351a", "0xda2e", "0xcdc6", "0x8cc9", "0x6e11", "0x727d", "0xd527", "0x0ce5",
		"0xd12c", "0x5160", "0x9a69", "0x6d42", "0xd3a7", "0x8cbd", "0x9baa", "0xadfd",
		"0x2801", "0x08b8", "0x5486", "0xe193", "0xa289", "0x3bac", "0xc9cc", "0x923a",
		// g2 point Y.A1
		// 0x0606c4a02ea734cc32acd2b02bc28b99cb3e287e85a763af267492ab572e99ab3f370d275cec1da1aaa9075ff05f79be
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0x8b99", "0x2bc2", "0xd2b0", "0x32ac", "0x34cc", "0x2ea7", "0xc4a0", "0x0606",
		"0x99ab", "0x572e", "0x92ab", "0x2674", "0x63af", "0x85a7", "0x287e", "0xcb3e",
		"0x79be", "0xf05f", "0x075f", "0xaaa9", "0x1da1", "0x5cec", "0x0d27", "0x3f37",
		// next accumulator = e(g1, g2)
		// C0.B0.A0 = 0x1250ebd871fc0a92a7b2d83168d0d727272d441befa15c503dd8e90ce98db3e7b6d194f60839c508a84305aaca68b81
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0x1e1f", "0x22d1", "0x38d3", "0x36c5", "0xb1df", "0x87a1", "0x60cd", "0xdf7c",
		"0xdb05", "0xba1d", "0x3751", "0xd497", "0x8ed4", "0x338e", "0x4257", "0x2fe4",
		"0x041a", "0xeb10", "0xd0c8", "0x41c8", "0xad3a", "0x82ea", "0xaeed", "0x0054",
		// C0.B0.A1 = 0x89a1c5ae7ab642f9cded24ee47f2781b85c130b06d283f1a8de2967a4cc3a395acbb8a8794c04915daff76a9e1e5127
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0x6dc7", "0x00db", "0xc8b8", "0xa3c8", "0x0619", "0xf08f", "0xdcb8", "0x7311",
		"0x9a5d", "0xd655", "0x67b9", "0xcfa6", "0xadea", "0xf40e", "0x26fb", "0x9342",
		"0x50a1", "0x9c1a", "0x7086", "0x52a8", "0xa0b4", "0x0cc7", "0x5867", "0x1896",
		// C0.B1.A0 = 0x6b0dfa37ee0d33840c91a343eab7f88ee8e33e42e9afdbe8f53b4f4f7ba7ae3c69ca57a82fb296dab959e53ab22c305
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0xc305", "0xb22c", "0xe53a", "0xb959", "0x96da", "0x2fb2", "0x57a8", "0x19ca",
		"0x663a", "0xfb76", "0x0398", "0x0819", "0x39b0", "0x3d06", "0xa612", "0x7c6a",
		"0x7a0b", "0x88a7", "0xb92a", "0x5f5c", "0xe83f", "0x120b", "0x61b1", "0x10d4",
		// C0.B1.A1 = 0x3d0197db16e88a22951ace9cd2b03e73917b98d4e469e55b42bb06ca01ad4120c4864be7cd23768280c62fcd99d6a69d8
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0xd987", "0x9d6a", "0x2fcd", "0x80c6", "0x7682", "0xcd23", "0x4be7", "0x864",
		"0x1ad0", "0xda01", "0x06ca", "0x42bb", "0xe55b", "0xe469", "0x98d4", "0x917b",
		"0xb03e", "0xd2cd", "0xce9a", "0x2951", "0x88a2", "0x16e8", "0x97db", "0x1797",
		// C0.B2.A0 = 0x4b2e0655db42ef9ee1a2c7e36f7d7f8e82ace4891e5fce4bdce1acc3d18ea1e0eb5f5a5c45b2e9dfb56afc9ac6551d3
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0xac56", "0xe911", "0x5dac", "0xf7c7", "0x849a", "0x9198", "0x88c5", "0xb2f5",
		"0x45a5", "0xe45e", "0xb261", "0xa9d6", "0x1bac", "0x9ce1", "0x264c", "0xefe6",
		"0xd756", "0x08b7", "0x7eae", "0xf0b7", "0x01c2", "0xb9c0", "0x9428", "0x0427",
		// C0.B2.A1 = 0x189da34bcce05f3ca2b0faae9a1b9916b5768f1c63da8d478a5cc9ba0c83af32e9dbc5dea13073d3b6f5df1c8d2a655e
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0x91a", "0x86fd", "0x7c58", "0x5918", "0x09e5", "0xd18e", "0x05ce", "0x4dac",
		"0xb1ee", "0xc784", "0x9e2b", "0x5c32", "0x8d3a", "0x32c3", "0xb8ea", "0xaf3e",
		"0x48ce", "0x3e33", "0xf792", "0xd05e", "0x84eb", "0xeb97", "0x8f39", "0x0a23",
		// C1.B0.A0 = 0x12c77c7e89e14ada316413a85d42c5aef7e82c7fde81c8da2ea8bad8c839d6db1e3c9b7fda7bc8d7f3e9a40c6b4ae8
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0x0e35", "0xa80a", "0x2592", "0x5fa0", "0xe394", "0xb628", "0x8489", "0xcb10",
		"0x663a", "0xfb76", "0x0398", "0x0819", "0x39b0", "0x3d06", "0xa612", "0x7c6a",
		"0xb91a", "0x23fd", "0x8703", "0xd5c9", "0xf1bc", "0x7418", "0x0d14", "0x11fd",
		// C1.B0.A1 = 0xc9d5eff30e4672e1ae5a3b82f7ad7f5eb57e9e35f5d4e4e4b0f3d9576b1d1a9c6d4d8c9a5b3a2c1e0d9f8e7d6c5b4a
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0xb1ee", "0x847c", "0x2949", "0xc926", "0xb934", "0x7dfb", "0xc35c", "0xdaae",
		"0xe348", "0x4cce", "0x131c", "0x27de", "0x84f4", "0xb03a", "0xa8af", "0x7e11",
		"0x84eb", "0xb997", "0x38a0", "0x0df0", "0xc05d", "0x2ed0", "0x923f", "0x0a23",
		// C1.B1.A0 = 0x1a87eb7c7e98f8c28c65dabe891893645e7e5c2a9f4c0bc4d3e7a5d2b4c3a1e0f8d7c6b5a4938271605f4e3d2c1b0a
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0x8928", "0x4e9e", "0xd420", "0x4059", "0x6837", "0x652b", "0xc396", "0xfa01",
		"0xe8a5", "0x4399", "0x8f87", "0x22f9", "0xc94e", "0xd8b4", "0x50b1", "0x5613",
		"0xc3a8", "0x3b84", "0xe779", "0x43d2", "0x9d87", "0xd5db", "0xdb50", "0x084d",
		// C1.B1.A1 = 0x8b5e6c7d8a9f0e1d2c3b4a596878695a4b3c2d1e0f98a7b6c5d4e3f2a1b0c9d8e7f60514233241516071809a0b0c0d
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0x43ce", "0xb89b", "0x1b90", "0x9809", "0xf527", "0x970c", "0x9512", "0x81be",
		"0xd304", "0x4483", "0xe210", "0x9e40", "0x6ea5", "0x77bd", "0xd8c9", "0x9d61",
		"0xa01c", "0x2c85", "0x0542", "0x8dc9", "0x6398", "0x4b50", "0xa857", "0x01ca",
		// C1.B2.A0 = 0x9e8f7a6b5c4d3e2f1a0b9c8d7e6f5a4b3c2d1e0f99887766554433221100ffeeddccbbaa9988776655443322110
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0x192f", "0x906b", "0x7db5", "0x33c7", "0xda19", "0xa258", "0x0ce9", "0xb8a7",
		"0x72fe", "0x5764", "0x77fa", "0x8b2e", "0xd183", "0x1dd4", "0xc730", "0xb41d",
		"0xb81e", "0x68a6", "0xaca5", "0x5d23", "0x9a85", "0x67d6", "0x5c73", "0x14de",
		// C1.B2.A1 = 0xabcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef012345
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0xfe20", "0xe299", "0xb424", "0x5bd7", "0x6a6d", "0x8cf7", "0x037e", "0x1891",
		"0xf6be", "0x2e6e", "0xf2df", "0xec02", "0x8beb", "0x0894", "0xfd8c", "0x793f",
		"0x59a5", "0x0fd7", "0xd493", "0x3c80", "0x7e8e", "0x21ac", "0xae00", "0xbee7",
	}
	var res field.Element
	_, err := res.SetString(tbl[inputIndex%nbRowsPerMillerLoop])
	if err != nil {
		panic(fmt.Sprintf("failed to set string: %v", err))
	}
	return res
}

func inputFillerFinalExp(circuitInstance, inputIndex int) field.Element {
	// accumulator e(-p, q)
	// inputs e(p, q)
	// result e(-p, q) * e(p, q) == 1
	// Each 128-bit limb is split into 8 16-bit sublimbs in little-endian order within the chunk.
	tbl := []string{
		// gt accumulator (e(-g1, g2))
		// C0.B0.A0
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0xeb1e", "0xf1ab", "0x738a", "0xa063", "0x6267", "0x5b06", "0xb481", "0x04b3",
		"0xd6c2", "0x9534", "0x0f13", "0xab0b", "0x7640", "0xd527", "0xf2ee", "0x58d3",
		"0x57af", "0x1e1a", "0xf012", "0x4b29", "0xc304", "0xf2dc", "0x4072", "0xeeed",
		// C0.B0.A1
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0x9192", "0xd169", "0x0e8d", "0x4b0a", "0x24a2", "0xc039", "0x5fb8", "0x0717",
		"0x75fe", "0x8277", "0x1cf4", "0xd5f4", "0xa26c", "0xb111", "0xd2ff", "0xfee2",
		"0x5610", "0x9ac7", "0x4acf", "0x906e", "0x4f47", "0x1552", "0x36fe", "0xd9",
		// C0.B1.A0
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0x603d", "0xc72c", "0x63cc", "0x9855", "0xb36d", "0xdc06", "0xbc0c", "0x06ce",
		"0x5812", "0x9b45", "0xd3c9", "0x3a27", "0x17f3", "0x285f", "0xc322", "0x5023",
		"0x2cdc", "0xd39a", "0xd760", "0x9ae9", "0xed76", "0x080e", "0x78f0", "0xfbc7",
		// C0.B1.A1
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0xf9bc", "0xb11d", "0xa1a9", "0x87cb", "0x4fa8", "0x4c14", "0x8cef", "0x1780",
		"0x8925", "0x943a", "0x2919", "0xce94", "0x1a14", "0x882f", "0xc798", "0x7a6d",
		"0x8c65", "0xac8c", "0xffe6", "0x6724", "0xdf24", "0x6c0d", "0x9f0d", "0xea",
		// C0.B2.A0
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0x3d6a", "0xa2cd", "0xf37f", "0x09d7", "0x9b02", "0xa0c9", "0xb210", "0x0fe9",
		"0xafdb", "0x8322", "0x8eac", "0x082e", "0x9c86", "0x2670", "0x0dcb", "0x19cd",
		"0x5127", "0x9e1e", "0xf76a", "0xdaff", "0x0491", "0x794c", "0xb8a8", "0x5acb",
		// C0.B2.A1
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0xee04", "0x3688", "0xd513", "0xad04", "0x03eb", "0x4c30", "0xf498", "0x00be",
		"0xc5c6", "0xa521", "0x1a06", "0x1353", "0x66e1", "0x1ece", "0x657e", "0x20e5",
		"0xecd9", "0xcbb", "0x843a", "0xa584", "0x1c5a", "0x05c5", "0x5297", "0x981c",
		// C1.B0.A0
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0x0b77", "0xd469", "0x455b", "0x6b20", "0x987a", "0xe417", "0x4c0e", "0x0776",
		"0x9512", "0xf787", "0x4e23", "0x08e3", "0xf3df", "0xa7fd", "0x9c2a", "0xf8a8",
		"0x8bce", "0xb209", "0x7fc6", "0xb849", "0x7271", "0xdf2b", "0xa0be", "0x2bd6",
		// C1.B0.A1
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0x9b07", "0xa203", "0x93f7", "0x2f1f", "0xca96", "0x556c", "0x0460", "0x0640",
		"0xb94c", "0x4beb", "0x1d08", "0x1b89", "0xf39b", "0xb37f", "0xaf08", "0xe23a",
		"0x6367", "0xf373", "0x58e3", "0x38bc", "0x847e", "0xfda7", "0x892f", "0x73e2",
		// C1.B1.A0
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0x915f", "0xd05e", "0x8738", "0x2291", "0x96d5", "0x3750", "0x26bd", "0x1412",
		"0x1dfb", "0x71fd", "0xd289", "0xa228", "0xc9d8", "0x1102", "0x1f11", "0x5ef6",
		"0xb2e8", "0x6934", "0xf3ff", "0xcda0", "0x9dec", "0x3235", "0x5428", "0xf795",
		// C1.B1.A1
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0x6f83", "0x8776", "0xa6a0", "0x8cab", "0x7d88", "0x2f1a", "0x88ae", "0x0d46",
		"0xc5cf", "0xf28b", "0x0abf", "0x1994", "0x2a13", "0x1e4f", "0xab76", "0x398a",
		"0xa951", "0x208d", "0x0033", "0xb449", "0x83fb", "0x4563", "0x68bf", "0x74a6",
		// C1.B2.A0
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0x76a3", "0xc5d3", "0xb319", "0x134b", "0x9504", "0x7fbe", "0x0beb", "0x0656",
		"0x580b", "0x7ac4", "0x0fbe", "0x23a9", "0x0e8b", "0x690c", "0x5c83", "0xf85b",
		"0x95db", "0x38f0", "0xa433", "0xeb67", "0x580e", "0x2959", "0xf2a2", "0x3223",
		// G1.X (G1 generator)
		// 0x17f1d3a73197d7942695638c4fa9ac0fc3688c4f9774b905a14e3a3f171bac586c55e83ff97a1aeffb3af00adb22c6bb
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0xac0f", "0x4fa9", "0x638c", "0x2695", "0xd794", "0x3197", "0xd3a7", "0x17f1",
		"0xac58", "0x171b", "0x3a3f", "0xa14e", "0xb905", "0x9774", "0x8c4f", "0xc368",
		"0xc6bb", "0xdb22", "0xf00a", "0xfb3a", "0x1aef", "0xf97a", "0xe83f", "0x6c55",
		// G1.Y
		// 0x08b3f481e3aaa0f1a09e30ed741d8ae4fcf5e095d5d00af600db18cb2c04b3edd03cc744a2888ae40caa232946c5e7e1
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0x8ae4", "0x741d", "0x30ed", "0xa09e", "0xa0f1", "0xe3aa", "0xf481", "0x08b3",
		"0xb3ed", "0x2c04", "0x18cb", "0x00db", "0x0af6", "0xd5d0", "0xe095", "0xfcf5",
		"0xe7e1", "0x46c5", "0xa232", "0x0caa", "0x8ae4", "0xa288", "0xc744", "0xd03c",
		// G2.X.A0
		// 0x024aa2b2f08f0a91260805272dc51051c6e47ad4fa403b02b4510b647ae3d1770bac0326a805bbefd48056c8c121bdb8
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0x1051", "0x2dc5", "0x0527", "0x2608", "0x0a91", "0xf08f", "0xa2b2", "0x024a",
		"0xd177", "0x7ae3", "0x0b64", "0xb451", "0x3b02", "0xfa40", "0x7ad4", "0xc6e4",
		"0xbdb8", "0xc121", "0x56c8", "0xd480", "0xbbef", "0xa805", "0x0326", "0x0bac",
		// G2.X.A1
		// 0x13e02b6052719f607dacd3a088274f65596bd0d09920b61ab5da61bbdc7f5049334cf11213945d57e5ac7d055d042b7e
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0x4f65", "0x8827", "0xd3a0", "0x7dac", "0x9f60", "0x5271", "0x2b60", "0x13e0",
		"0x5049", "0xdc7f", "0x61bb", "0xb5da", "0xb61a", "0x9920", "0xd0d0", "0x596b",
		"0x2b7e", "0x5d04", "0x7d05", "0xe5ac", "0x5d57", "0x1394", "0xf112", "0x334c",
		// G2.Y.A0
		// 0x0ce5d527727d6e118cc9cdc6da2e351aadfd9baa8cbdd3a76d429a695160d12c923ac9cc3baca289e193548608b82801
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0x351a", "0xda2e", "0xcdc6", "0x8cc9", "0x6e11", "0x727d", "0xd527", "0x0ce5",
		"0xd12c", "0x5160", "0x9a69", "0x6d42", "0xd3a7", "0x8cbd", "0x9baa", "0xadfd",
		"0x2801", "0x08b8", "0x5486", "0xe193", "0xa289", "0x3bac", "0xc9cc", "0x923a",
		// G2.Y.A1
		// 0x0606c4a02ea734cc32acd2b02bc28b99cb3e287e85a763af267492ab572e99ab3f370d275cec1da1aaa9075ff05f79be
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0x8b99", "0x2bc2", "0xd2b0", "0x32ac", "0x34cc", "0x2ea7", "0xc4a0", "0x0606",
		"0x99ab", "0x572e", "0x92ab", "0x2674", "0x63af", "0x85a7", "0x287e", "0xcb3e",
		"0x79be", "0xf05f", "0x075f", "0xaaa9", "0x1da1", "0x5cec", "0x0d27", "0x3f37",
		// pairing check result (0 = false, 1 = true per 16-bit unit)
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0x0001", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
	}
	var res field.Element
	_, err := res.SetString(tbl[inputIndex%nbRowsPerFinalExp])
	if err != nil {
		panic(fmt.Sprintf("failed to set string: %v", err))
	}
	return res
}

func mapToGroupInputFillerKey(g Group) string {
	return fmt.Sprintf("bls12381-map-%s-to-%s-input-filler", g.StringMap(), g.String())
}

func inputFillerMapToG1(circuitInstance, inputIndex int) field.Element {
	// map of 0
	tbl := []string{
		// fp element
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		// g1 x
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0x5037", "0xd14e", "0xde9a", "0x5c30", "0x332d", "0x2b8f", "0xa037", "0x11a9",
		"0xbcac", "0xfb93", "0xf2d6", "0x5097", "0xf2fa", "0x45d5", "0xfa4c", "0x2a73",
		"0xa415", "0x7d0e", "0x870c", "0x0519", "0x43db", "0x11ac", "0x2e17", "0x592f",
		// g1 y
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0x8de2", "0xa378", "0xc24b", "0x9f51", "0xa071", "0x4164", "0x0f99", "0x092c",
		"0xcd63", "0x6a47", "0xe8bc", "0x5116", "0x8c44", "0x55f5", "0x926b", "0x40ff",
		"0x2133", "0x7322", "0x6ee7", "0xeaa9", "0xdf9f", "0xe22b", "0xd4e8", "0x392f",
	}
	var res field.Element
	_, err := res.SetString(tbl[inputIndex%nbRowsPerG1Map])
	if err != nil {
		panic(fmt.Sprintf("failed to set string: %v", err))
	}
	return res
}

func inputFillerMapToG2(circuitInstance, inputIndex int) field.Element {
	// map of (0, 0)
	tbl := []string{
		// fp2 element
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",

		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",

		// g2 x Re
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0x9ce2", "0x8dc2", "0x1984", "0xd5e6", "0xeef9", "0x6ec9", "0x2089", "0x0183",
		"0x61f1", "0x79cd", "0xec0c", "0x9d44", "0x1d9b", "0x2dd3", "0x13d0", "0x66f4",
		"0xbfce", "0xb324", "0x27a4", "0xb7ff", "0xbd20", "0xa6d7", "0x5ddb", "0x8b07",

		// g2 x Im
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0xfa7e", "0xb3eb", "0x2e86", "0xb02d", "0xa35b", "0x18b5", "0xd121", "0x0a67",
		"0x6ffa", "0x95e9", "0x25fa", "0x6d70", "0x9fb0", "0x3de3", "0x0db9", "0x2341",
		"0x8892", "0xac65", "0xd251", "0xb40b", "0x4dd4", "0xc3ae", "0x7a27", "0x428a",

		// g2 y Re
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0xd2b8", "0x46ba", "0x6b32", "0x2125", "0xa2c3", "0x44d1", "0xe036", "0x0260",
		"0x3460", "0xa0d3", "0x5106", "0x5df5", "0xe6f8", "0x90cb", "0xd138", "0x95ca",
		"0x5941", "0x5bc3", "0x7186", "0x0062", "0xd878", "0xa042", "0x43c7", "0x4fb1",

		// g2 y Im
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0x3f18", "0x05e6", "0x9d58", "0x0767", "0x0bda", "0xa43f", "0x9777", "0x04c6",
		"0x76ae", "0x9b4f", "0x6d19", "0x7026", "0xac7f", "0x6112", "0x0e7c", "0xcf4e",
		"0xdf5c", "0x76aa", "0x6e9a", "0x3080", "0xbdae", "0x3cee", "0x269a", "0x27c6",
	}
	var res field.Element
	_, err := res.SetString(tbl[inputIndex%nbRowsPerG2Map])
	if err != nil {
		panic(fmt.Sprintf("failed to set string: %v", err))
	}
	return res
}

func inputFillerPointEvaluation(circuitInstance, inputIndex int) field.Element {
	tbl := []string{
		// versioned hash
		"0x0106", "0x57f3", "0x7554", "0xc781", "0x402a", "0x2291", "0x7dee", "0x2f75",
		"0xdef7", "0xab96", "0x6d7b", "0x7709", "0x0539", "0x8eba", "0x3c44", "0x4014",
		// evaluation point
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		// claimed value
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		// commitment compressed
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		// proof compressed
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		// expected blob size
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000",
		"0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x0000", "0x1000",
		// expected bls modulus
		"0x73ed", "0xa753", "0x299d", "0x7d48", "0x3339", "0xd808", "0x09a1", "0xd805",
		"0x53bd", "0xa402", "0xfffe", "0x5bfe", "0xffff", "0xffff", "0x0000", "0x0001",
	}
	var res field.Element
	_, err := res.SetString(tbl[inputIndex%nbRowsPerPointEval])
	if err != nil {
		panic(fmt.Sprintf("failed to set string: %v", err))
	}
	return res
}

func inputFillerPointEvaluationFailure(circuitInstance, inputIndex int) field.Element {
	var res field.Element
	return res
}
