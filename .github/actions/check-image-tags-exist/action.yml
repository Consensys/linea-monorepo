name: 'Check image tags exist'

description: 'Verifies if the specified image tag exist in the container registry'

inputs:
  last_commit_tag:
    description: 'The tag of the image from the last commit to check for existence'
    required: true
  image_name:
    description: 'The name of the container image to check'
    required: true

outputs:
  last_commit_tag_exists:
    description: 'Indicates whether the image tag from the last commit exists'
    value: ${{ steps.check_image_tag.outputs.tag_exists }}

runs:
  using: 'composite'
  steps:
    - name: Check if the last commit image tag exists
      id: check_image_tag
      shell: bash
      continue-on-error: true
      run: |
        if docker pull "${{ inputs.image_name }}:${{ inputs.last_commit_tag }}" > /dev/null 2>&1; then
          echo "tag_exists=true" >> $GITHUB_OUTPUT
        else
          echo "tag_exists=false" >> $GITHUB_OUTPUT
        fi

    - name: Display output
      shell: bash
      run: |
        echo "Image tag exists: ${{ steps.check_image_tag.outputs.tag_exists }}"
